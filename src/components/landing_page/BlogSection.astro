---
import { getCollection } from "astro:content";
import BlogPostCard from "../BlogPostCard.astro";
import { render } from "astro:content";

const posts = await getCollection("posts");
posts.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());
const recentPosts = posts.slice(0, 4);

const postPreviews = await Promise.all(
  recentPosts.map(async (post) => {
    return (await render(post)).remarkPluginFrontmatter.preview as string;
  }),
);
---

<section id="blog">
  <h2>Blog</h2>
  <div class="blog-posts">
    {
      recentPosts.map((post, i) => (
        <BlogPostCard title={post.data.title} text={postPreviews[i]} />
      ))
    }
  </div>
  <a href="/blog" class="see-more">see more</a>
</section>

<style>
  section {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    padding: 0 var(--landing-page-section-x-pad);
  }

  .blog-posts {
    width: 100%;
    max-width: var(--card-grid-max-width);
    align-self: center;

    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
  }

  @media (max-width: 768px) {
    .blog-posts {
      grid-template-columns: 1fr;
    }
  }
</style>
