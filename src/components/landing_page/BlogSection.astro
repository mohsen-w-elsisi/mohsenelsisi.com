---
import { getCollection } from "astro:content";
import BlogPostCard from "../BlogPostCard.astro";
import { render } from "astro:content";

const posts = await getCollection("posts");
posts.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());
const recentPosts = posts.slice(0, 4);

const recentPostData = await Promise.all(
  recentPosts.map(async (post) => {
    const preview = (await render(post)).remarkPluginFrontmatter
      .preview as string;
    return {
      id: post.id,
      title: post.data.title,
      date: post.data.date,
      preview,
    };
  }),
);
---

<section id="blog">
  <h2>Blog</h2>
  <div class="blog-posts">
    {
      recentPostData.map(({ id, title, date, preview }) => (
        <BlogPostCard id={id} title={title} date={date} preview={preview} />
      ))
    }
  </div>
  <a href="/blog" class="see-more">see more</a>
</section>

<style>
  section {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    padding: 0 var(--landing-page-section-x-pad);
  }

  .blog-posts {
    width: 100%;
    margin: auto;
    align-self: center;

    display: grid;
    place-items: center;
    gap: 1rem;
  }

  @media (max-width: 1060px) {
    .blog-posts {
      grid-template-columns: 1fr;
      max-width: var(--blog-card-single-col-grid-max-width);
    }
  }

  @media (min-width: 1061px) {
    .blog-posts {
      grid-template-columns: 1fr 1fr;
      max-width: var(--card-grid-max-width);
    }
  }
</style>
